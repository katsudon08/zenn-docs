---
title: "IndexedDBã«ãŠã‘ã‚‹IDè¨­è¨ˆã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’æœ¬è³ªã‹ã‚‰ç†è§£ã™ã‚‹"
emoji: "ðŸ—ƒï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["IndexedDB", "JavaScript", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹"]
published: true
---

::: message
æœ¬è¨˜äº‹ã¯AIã¨ã¨ã‚‚ã«åŸ·ç­†ã—ã¦ãŠã‚Šã¾ã™ã€‚
èª¤ã‚Šãªã©ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆã§æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ðŸ˜¢
:::

# ã¯ã˜ã‚ã«

Webã‚¢ãƒ—ãƒªé–‹ç™ºã§ IndexedDB ã‚’ä½¿ã„å§‹ã‚ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªç–‘å•ã«å¿…ãšã¶ã¤ã‹ã‚Šã¾ã™ã€‚

- ID ã¯ã©ã†ã‚„ã£ã¦ç”Ÿæˆã™ã‚‹ã®ãŒæ­£è§£ãªã®ã‹ï¼Ÿ
- `autoIncrement` ã¯ã„ã¤ä½¿ã£ã¦ã„ã„ã®ã‹ï¼Ÿ
- UUID ã‚„ nanoid ã¯ãªãœæŽ¨å¥¨ã•ã‚Œã‚‹ã®ã‹ï¼Ÿ
- IndexedDB ã®ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€ã¯ä½•ã®ãŸã‚ã«å­˜åœ¨ã™ã‚‹ã®ã‹ï¼Ÿ

æœ¬è¨˜äº‹ã§ã¯ã€ã“ã‚Œã‚‰ã®ç–‘å•ã«å¯¾ã—ã¦  
**ã€ŒåŒæœŸãƒ»å…±æœ‰ã€ã€Œåˆ†æ•£ç’°å¢ƒã€ã¨ã„ã†å‰æã‹ã‚‰**ã€  
**IDè¨­è¨ˆã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®æœ¬è³ª**ã‚’æ•´ç†ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. IndexedDB ã«ãŠã‘ã‚‹ ID ç”Ÿæˆæ‰‹æ³•ã®å…¨ä½“åƒ

IndexedDB ã§ã¯ã€å¤§ããæ¬¡ã® 3 ç³»çµ±ã® ID ç”Ÿæˆæ–¹æ³•ãŒä½¿ã‚ã‚Œã¾ã™ã€‚

- `crypto.randomUUID()`
- `autoIncrement`
- `nanoid` ãªã©ã®å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

ã“ã‚Œã‚‰ã¯ **ã©ã‚ŒãŒå„ªã‚Œã¦ã„ã‚‹ã‹ã§ã¯ãªãã€å‰ææ¡ä»¶ãŒé•ã†** ã¨ã„ã†ç‚¹ãŒé‡è¦ã§ã™ã€‚

---

## 2. `crypto.randomUUID()` ã¨ã¯ä½•ã‹

### 2.1 æ¦‚è¦

`crypto.randomUUID()` ã¯ã€Web Crypto API ãŒæä¾›ã™ã‚‹  
**RFC 4122 æº–æ‹ ã® UUID v4 ã‚’ç”Ÿæˆã™ã‚‹æ¨™æº– API** ã§ã™ã€‚

```ts
const id = crypto.randomUUID();
// ä¾‹: "3b12f1df-5232-4804-897e-917bf397618a"
````

### 2.2 ç‰¹å¾´

* æš—å·å­¦çš„ã«å®‰å…¨ãªä¹±æ•°ã‚’ä½¿ç”¨
* è¡çªç¢ºçŽ‡ãŒæ¥µã‚ã¦ä½Žã„
* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ç‹¬ç«‹ã—ã¦ç”Ÿæˆå¯èƒ½
* æ¨™æº– APIï¼ˆè¿½åŠ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¦ï¼‰

### 2.3 å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹

* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚¢ãƒ—ãƒª
* å°†æ¥ã‚µãƒ¼ãƒãƒ¼åŒæœŸã‚’è¡Œã†å¯èƒ½æ€§ãŒã‚ã‚‹
* è¤‡æ•°ç«¯æœ«ãƒ»è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†

---

## 3. IndexedDB ã® `autoIncrement` ã¨ã¯ä½•ã‹

### 3.1 æ¦‚è¦

IndexedDB ãŒå†…éƒ¨ã§ç®¡ç†ã™ã‚‹ **é€£ç•ª ID ç”Ÿæˆæ©Ÿèƒ½** ã§ã™ã€‚

```ts
db.createObjectStore("items", {
  keyPath: "id",
  autoIncrement: true
});
```

### 3.2 ç‰¹å¾´

* `1, 2, 3, ...` ã¨è‡ªå‹•æŽ¡ç•ª
* å®Ÿè£…ãŒéžå¸¸ã«ç°¡å˜
* æ•°å€¤ ID ã§è»½é‡

### 3.3 æ³¨æ„ç‚¹

`autoIncrement` ã¯ **ãã® IndexedDB å†…ã§ã—ã‹ä¸€æ„ã§ã‚ã‚‹ä¿è¨¼ãŒã‚ã‚Šã¾ã›ã‚“**ã€‚

ã¤ã¾ã‚Šã€

* åˆ¥ã®ç«¯æœ«
* åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶
* åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼

ã§ã¯ **åŒã˜ ID ãŒæ™®é€šã«ç”Ÿæˆã•ã‚Œã¾ã™**ã€‚

### 3.4 å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹

* å®Œå…¨ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Œçµã™ã‚‹ã‚¢ãƒ—ãƒª
* ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã¨åŒæœŸãƒ»å…±æœ‰ã—ãªã„
* DB å†…éƒ¨ã§ã®ã¿è­˜åˆ¥ã§ãã‚Œã°ã‚ˆã„å ´åˆ

---

## 4. nanoid ã¨ã¯ä½•ã‹

### 4.1 æ¦‚è¦

`nanoid` ã¯ã€**çŸ­ãã¦è¡çªã—ã«ãã„ ID ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã§ã™ã€‚

```ts
import { nanoid } from "nanoid";

const id = nanoid();
// ä¾‹: "V1StGXR8_Z5jdHi6B-myT"
```

### 4.2 ç‰¹å¾´

* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 21 æ–‡å­—
* URL-safe
* UUID ã‚ˆã‚ŠçŸ­ã„
* è¡çªç¢ºçŽ‡ã¯éžå¸¸ã«ä½Žã„

### 4.3 å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹

* React / Vue ã® key
* URL ã«åŸ‹ã‚è¾¼ã‚€ ID
* UI å´ã§æ‰±ã„ã‚„ã™ã„è­˜åˆ¥å­

---

## 5. ã€ŒåŒæœŸãƒ»å…±æœ‰ã€ã¨ã¯ä½•ã‚’æŒ‡ã™ã®ã‹

### 5.1 åŒæœŸï¼ˆSyncï¼‰

**è¤‡æ•°ã®å ´æ‰€ã«å­˜åœ¨ã™ã‚‹åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€è‡´ã•ã›ã‚‹ã“ã¨**ã‚’æŒ‡ã—ã¾ã™ã€‚

ä¾‹ï¼š

* IndexedDB ã«ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä¸­ã«ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾Œã‹ã‚‰åŒæœŸ

```text
IndexedDBï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰
   â†• åŒæœŸ
ã‚µãƒ¼ãƒãƒ¼
```

### 5.2 å…±æœ‰ï¼ˆShareï¼‰

**è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»è¤‡æ•°ç«¯æœ«ãŒåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã“ã¨**ã§ã™ã€‚

* ã‚¹ãƒžãƒ›ã¨ PC ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹
* å®¶æ—ãƒ»ãƒãƒ¼ãƒ ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹

---

## 6. åˆ†æ•£ç’°å¢ƒã¨ã¯ä½•ã‹

### 6.1 å®šç¾©

åˆ†æ•£ç’°å¢ƒã¨ã¯ã€

> **1 ã¤ã®ä¸­å¤®ç®¡ç†è€…ãŒå­˜åœ¨ã›ãšã€è¤‡æ•°ã®å ´æ‰€ãŒç‹¬ç«‹ã—ã¦å‹•ãç’°å¢ƒ**

ã‚’æŒ‡ã—ã¾ã™ã€‚

### 6.2 Web ã‚¢ãƒ—ãƒªã«ãŠã‘ã‚‹åˆ†æ•£ç’°å¢ƒ

* å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶
* å„ç«¯æœ«ã® IndexedDB
* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹

```text
ç«¯æœ«Aï¼ˆIndexedDBï¼‰
ç«¯æœ«Bï¼ˆIndexedDBï¼‰
ç«¯æœ«Cï¼ˆIndexedDBï¼‰
      â†“
    ã‚µãƒ¼ãƒãƒ¼
```

### 6.3 ãªãœåˆ†æ•£ç’°å¢ƒã§ã¯ autoIncrement ãŒå±é™ºãªã®ã‹

| ç«¯æœ« | ä½œæˆ   | ID |
| -- | ---- | -- |
| A  | task | 1  |
| B  | task | 1  |

â†’ **åŒã˜ ID ãŒè¡çªã™ã‚‹**

ã“ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã€
UUID ã‚„ nanoid ã®ã‚ˆã†ãª **åˆ†æ•£è€æ€§ã®ã‚ã‚‹ ID** ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

---

## 7. IndexedDB ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ã¯ä½•ã‹

### 7.1 çµè«–

IndexedDB ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¯ã€

> **æ—¢ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«ã«å­˜åœ¨ã™ã‚‹ DB ã‚’å£Šã•ãšã«ã€æ§‹é€ ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚**

ã«å­˜åœ¨ã—ã¾ã™ã€‚

---

## 8. ãªãœãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå¿…è¦ãªã®ã‹

### 8.1 IndexedDB ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«å­˜åœ¨ã™ã‚‹

* ãƒ¦ãƒ¼ã‚¶ãƒ¼ Aï¼šå¤ã„ DB
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ Bï¼šã•ã‚‰ã«å¤ã„ DB
* æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼šDB æœªä½œæˆ

ðŸ‘‰ **å…¨å“¡ã®çŠ¶æ…‹ãŒé•ã†**

---

### 8.2 æ§‹é€ å¤‰æ›´ã¯ç‰¹åˆ¥ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã—ã‹ã§ããªã„

IndexedDB ã§ã¯æ¬¡ã®æ“ä½œã¯é€šå¸¸æ™‚ã«ã§ãã¾ã›ã‚“ã€‚

* objectStore ã®ä½œæˆãƒ»å‰Šé™¤
* index ã®ä½œæˆãƒ»å‰Šé™¤

ã“ã‚Œã‚‰ã¯ **`onupgradeneeded` ã®ä¸­ã§ã®ã¿å¯èƒ½**ã§ã™ã€‚

---

## 9. `onupgradeneeded` ã®å½¹å‰²

```ts
const request = indexedDB.open("app-db", 3);

request.onupgradeneeded = (event) => {
  const db = request.result;
  const oldVersion = event.oldVersion;

  if (oldVersion < 1) {
    db.createObjectStore("users", { keyPath: "id" });
  }

  if (oldVersion < 2) {
    db.createObjectStore("tasks", { keyPath: "id" });
  }
};
```

### ãƒã‚¤ãƒ³ãƒˆ

* ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰æ¥ã¦ã‚‚å®‰å…¨
* æ®µéšŽçš„ã«ã‚¹ã‚­ãƒ¼ãƒžã‚’é€²åŒ–ã§ãã‚‹
* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚è‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã‚‹

---

## 10. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒãªã‹ã£ãŸã‚‰èµ·ãã‚‹å•é¡Œ

* æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒå¤ã„ DB ã‚’å‰æã«ã—ã¦ã„ãªã„
* å­˜åœ¨ã—ãªã„ store / index ã«ã‚¢ã‚¯ã‚»ã‚¹
* ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å³ã‚¯ãƒ©ãƒƒã‚·ãƒ¥

ðŸ‘‰ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½•ã‚‚ã§ããªããªã‚‹**

---

## 11. å®Ÿå‹™çš„ãªçµè«–

### ID è¨­è¨ˆ

* å®Œå…¨ãƒ­ãƒ¼ã‚«ãƒ« â†’ `autoIncrement`
* åŒæœŸãƒ»å…±æœ‰ã‚ã‚Š â†’ `crypto.randomUUID()`
* UI / URL ç”¨ â†’ `nanoid`

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

* ã‚¹ã‚­ãƒ¼ãƒžå¤‰æ›´ã”ã¨ã«å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹
* `onupgradeneeded` ã§æ®µéšŽçš„ã«ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›¸ã
* ã€Œå¾Œã‹ã‚‰ç›´ã™ã€ã¯ã»ã¼ä¸å¯èƒ½ã¨è€ƒãˆã‚‹

---

## 12. ã¾ã¨ã‚

* IndexedDB ã¯ **åˆ†æ•£ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‰æã® DB**
* ID è¨­è¨ˆã¯ **å°†æ¥ã®åŒæœŸãƒ»å…±æœ‰ã‚’è¦‹æ®ãˆã¦æ±ºã‚ã‚‹**
* ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¯ **ãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã‚‹ãŸã‚ã®å®‰å…¨è£…ç½®**

IndexedDB ã‚’æ­£ã—ãç†è§£ã™ã‚‹ã¨ã€
ã€Œãªãœã“ã®ä»•æ§˜ãªã®ã‹ã€ãŒã™ã¹ã¦ç¹‹ãŒã£ã¦è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
