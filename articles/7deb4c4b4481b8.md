---
title: "【React基礎】配列データをUIに変える！リストレンダリング完全ガイド"
emoji: "📜"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React", "初心者", "フロントエンド"]
published: true
---
# 1.はじめに
SNSの投稿一覧や、商品リストなどのアプリケーションの多く（別名**バーティカル・タイムライン**とも呼ばれますね）はデータの配列を繰り返し表示することで成り立っています。

Reactでは、このような配列データを表示する際、`for`文ではなく、JavaScriptの配列メソッド（主に`map`）を用いることで、コンポーネントのレンダリングを行います。

今回は、そんなリストレンダリングの基本的な方法と注意点について解説します！

# 2.`map`を使った基本のレンダリング
Reactでは、HTMLのように`<li>`タグを1つずつ手書きする必要はありません。
JavaScript(TypeScript)の配列メソッドである`map`メソッドを使えば、データの数だけ自動でコンポーネントを生成できます。

以下、具体例です。

```ts
export default function TodoList() {
    const todos = ['item1', 'item2', 'item3'];
    // もしアロー関数の次に波括弧 {} が続く場合は、必ずreturn文が必要です！
    const listItems = todos.map(todo => (
        <li key={todo}>
            {todo}
        </li>
    ));

    return (
        <ul>
            {listItems}
        </ul>
    );
}
```

または、下記のようにJSXの中に埋め込む形でも書けます。

```ts
export default function TodoList() {
    const todos = ['item1', 'item2', 'item3'];

    return (
        <ul>
            {todos.map(todo => (
                <li key={todo}>
                    {todo}
                </li>
            ))}
        </ul>
    );
}
```

:::message
上記2つの例で、それぞれリストアイテムに対して`key`属性が指定されていることに気づいたでしょうか？

これは、Reactがレンダリングの際に、どのアイテムが変更・追加・削除されたのかを特定するために必要な情報です。
（そのため、他の`key`と被ってしまってはいけません！）

ですので、動的に作成されるような値やレンダリングのたびに変わってしまうような値を`key`に指定するのは避けましょう。
:::

では、なぜ`for`文や`forEach`メソッドではなく、`map`メソッドを使うのでしょうか？

それについての違いは**命令的**か**宣言的**かの違いにあります。

**命令的**である`for`文や`forEach`メソッドは処理を実行するものですが、**宣言的**である`map`メソッドは新しい配列を返すメソッドです。

ReactのJSXは、配列の中にJSX要素が入っていれば、それらを展開してレンダリングしてくれるため、`map`メソッドと非常に相性が良いです！

# 3.`filter`でデータを絞り込む
単にリストをすべて表示するだけでなく、「特定の条件に合うものだけを表示する」というのは頻出するパターンです。

「絞り込んでから、描画する」という2ステップの流れを実現するには、`filter`メソッドと`map`メソッドを組み合わせて使います。

以下、具体例です。

```ts
const people = [
    { id: 0, name: 'マリー', isFriend: true },
    { id: 1, name: 'ジョン', isFriend: false },
    { id: 2, name: 'アリス', isFriend: true },
];

export default function FriendList() {
    const friends = people.filter(person =>
        person.isFriend
    );

    const listItems = friends.map(friend =>
        <li key={friend.id}>
            {friend.name}
        </li>
    );

    return <ul>{listItems}</ul>;
}
```

上記の例では、変数を分けてフィルタリングとマッピングを行っていますが、`filter`と`map`を**メソッドチェーン**という手法で、JSXの中で動的にリストを生成することもできます。

```ts
return (
    <ul>
        {people
            .filter(person => person.isFriend)
            .map(friend => (
                <li key={friend.id}>{friend.name}</li>
            ))
        }
    </u>
)
```

また、これまで紹介してきた`filter`も`map`も元の配列を書き換えるのではなく、新しい配列を作成し、それを返します。
この「**イミュータブル（不変）**」な性質は、Reactにおいてバグを防ぐためにとても重要な考え方ですので、頭の片隅にとどめておきましょう！

# 4.リストレンダリングの整理術
これまでの章で、リストの表示方法は理解してきましたが、「`map`の中身が長くなりすぎて、どこまでがリストの処理かわからない」という事態がよく起こります。

コードの保守性を高めるために、コンポーネントを切り出すようにしていきましょう！

リストの各アイテム（例としては`<li>`タグなど）の中身が複雑になってきたら**1つの独立したコンポーネントとして切り出す**のがReactの定石です。
これにより、コードの見通しがかなり良くなります。

以下、具体例です。

```ts
// ❌ 読みづらい例
return (
    <ul>
        {people.map(person => (
            <li key={person.id}>
                <img src={person.imageUrl} alt={person.name} />
                <div>
                    <h3>{person.name}</h3>
                    <p>{person.description}</p>
                    <button onClick={() => handleFollow(person.id)}>フォロー</button>
                </div>
            </li>
        ))}
    </ul>
)
```

```ts
interface PersonItemProps {
    id: number;
    imageUrl: string;
    name: string;
    description: string;
}

// 1. アイテム用のコンポーネントを定義
function PersonItem({ person }: PersonItemProps) {
    return (
        <li>
        <img src= { person.imageUrl } alt = { person.name } />
            <div>
            <h3>{ person.name } </h3>
            < p > { person.description } </>
            </div>
            </li>
  );
}

// 2. 親コンポーネントでは map をスッキリ書く
export default function List() {
    return (
        <ul>
        {
            people.map(person => (
                <PersonItem key= { person.id } person = { person } />
      ))
        }
        </ul>
    );
}
```

:::message
コンポーネントを切り出した際、`key`を書く場所はどうすればいいの？となると思います。

その答えは、`map`のすぐ内側の要素（呼び出し側）です。
切り出したコンポーネントの`<li>`につけてもReactは「配列の中の要素」として識別してくれないので注意しましょう！
:::

# 5.まとめ
Reactのデータを繰り返し表示する際のポイントは、**いかに効率よく、安全にJSXへ変換するか**です。

リスト操作は次の3つのステップで完結します。

- **抽出**（`filter`）：必要なデータを選ぶ
- **変換**（`map`）：データをJSX要素に変える
- **表示**：変換したJSXの配列を`{}`で埋め込む

それに加えて`key`の絶対ルールである**一意**と**不変**についても気を付けるようにしましょう！

# 6.参考
- [リストのレンダー](https://ja.react.dev/learn/rendering-lists)