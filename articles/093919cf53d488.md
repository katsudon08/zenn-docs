---
title: "Three.js入門ガイド：ブラウザの中に3Dを実現する技術"
emoji: "👓"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Three"]
published: true
---
# はじめに

`Three.js`はHTML5で3Dコンテンツを制作するために用いられるJavaScriptライブラリです。
WebGPUやWebGLを素のAPIだけで表現しようとすると、立方体1つ表示するだけで、膨大なJavaScriptやWGSL/GLSLコードが必要となります。
`Three.js`を使えばJavaScriptを中心に3Dコンテンツを作成することができるため、手軽に扱えるようになります！

今では標準技術のWebGLに加えてWebGPUも利用が進み、ゲームやビジュアライゼーションなどの多くの場面で採用されています。

::: details WGSL/GLSLとは？
WGSL/GLSLとはどちらも**シェーダー言語**と呼ばれるプログラミング言語の一種です。

これらは、CPUではなく、GPU上で動作するプログラムを書くために使用されます。主に3Dグラフィックスの描画や計算処理を高速化するために利用されます。

シェーダーは二種類存在し、頂点シェーダーとフラグメントシェーダーで構成され、それぞれ頂点とピクセルの計算を行います。
:::

# 入門してみる

まずは、HTMLファイルを用意して以下のコードを添付して試してみてください。

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.webgpu.js",
          "three/webgpu": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.webgpu.js"
        }
      }
    </script>
    <script type="module">
      import * as THREE from "three/webgpu";

      // サイズを指定
      const width = 960;
      const height = 540;

      // レンダラーを作成
      const renderer = new THREE.WebGPURenderer({
        canvas: document.querySelector("#myCanvas"),
      });
      renderer.setPixelRatio(devicePixelRatio);
      renderer.setSize(width, height);

      renderer.setAnimationLoop(tick);

      // シーンを作成
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      // カメラを作成
      const camera = new THREE.PerspectiveCamera(45, width / height);
      camera.position.set(0, 0, +1000);

      // 箱を作成
      const geometry = new THREE.BoxGeometry(400, 400, 400);
      const material = new THREE.MeshNormalMaterial();
      const box = new THREE.Mesh(geometry, material);
      scene.add(box);

      // 毎フレーム時に実行されるループイベントです
      function tick() {
        box.rotation.y += 0.01;
        renderer.render(scene, camera); // レンダリング
      }
    </script>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>
  </body>
</html>
```

上記コードはブラウザの画面上に単色の直方体が回転する様子が描画されます。

`Three.js`の``WebGPURenderer`は、WebGPUが有効な環境ではWebGPUで動作し、非対応環境ではWebGL2へとフォールバックします。

これから、上記のコードを細かく解説していきます。

::: message
先ほどから登場しているWebGPUに加えて、WebGL2というのも登場したので、少し解説します。

これらは、どちらもWebブラウザ上でGPU（グラフィックス・プロセッシング・ユニット）を利用するためのAPIです。

WebGL2は「**枯れた安定した技術**」、WebGPUは「**次世代の高性能な標準**」です。
2026年現在、主要なブラウザすべてでWebGPUが正式にサポートされています。
:::

## `canvas`要素を用意する

`Three.js`はHTML5の`canvas`要素を利用します。`canvas`要素はコンテンツを表示する描画のエリアとなります。
これの上に3Dコンテンツをどんどん積み重ねていきます。

```html
<body>
  <canvas id="myCanvas"></canvas>
</body>
```

`canvas`要素の大きさはJavaScriptを用いて設定することができます。

## JSライブラリを読み込んでみる

`Three.js`はJavaScriptのライブラリですが、このファイルを読み込むことで初めて利用することが可能になります。

CDN（コンテンツ・デリバリー・ネットワーク）で提供されているURLを使います。
ECMAScript Modulesの仕組みを使って、`import`文で`Three.js`を読み込みます

```html
<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.webgpu.js",
      "three/webgpu": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.webgpu.js"
    }
  }
</script>
```

::: details CDNとは？
コンテンツ・デリバリー・ネットワーク（CDN）とは、世界中に分散されたサーバーのネットワークを利用して、Webコンテンツ（画像、動画、HTML、JavaScriptなど）をユーザーにより早く・安定して届けるための仕組みです。

Webサイトのデータを保管している**オリジンサーバー**の代わりに、ユーザーの近くにある**エッジサーバー**がデータを素早く手渡します。
いわゆるキャッシュというやつですね。
:::

3Dの処理はJavaScriptで記述します。
`Three.js`はES Modulesに対応しているため、`import`文で読み込むことができます。
`import`文は`<script>`要素の`type`属性に`module`を指定することで利用が可能になります。

```html
<script type="module">
import * as THREE from "three/webgpu";
</script>
```

## 3D表示用のJSを用意

3Dのレンダリングをするためにレンダラーと呼ばれるものを作成します。
`THREE.WebGPURenderer`クラスのコンストラクターには引数として、HTMLに配置した`canvas`要素を指定し、連携させます。

```js
const renderer = new THREE.WebGPURenderer({
  // idを指定してcanvas要素を取得
  canvas: document.querySelector('#myCanvas')
});

renderer.setSize(960, 540);
renderer.setPixelRatio(devicePixelRatio)
```

`setSize`により、`canvas`の大きさを指定し、`setPixelRatio`で画面のきめ細かさ（ピクセルの密度）に合わせて、3D描画の解像度を調整します。（これにより、描画ぼやけずくっきり表示されます）

## シーンの作成

シーンと呼ばれる3D空間を作成し、3Dオブジェクトや光源などを設置していきます。

```js
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);
```

ここで設定している背景色は、16進数で黒色を表します。

## カメラを設置する

3Dでは、オブジェクトが映る視点となるカメラを実装しなければ画面に表示することができません。

`Three.js`では`THREE.PerspectiveCamera`クラスのコンストラクターでがかく、アスペクト比、描画開始距離、描画終了距離の4つの情報を引数として渡すことでカメラを作成します。

ちなみに一般的に3DCGの分野において、カメラには2つの種類が存在し、平行投影と透視投影というものがあります。
今回用いる`THREE.PerspectiveCamera`は透視投影のカメラで、奥行きが存在するカメラとなります。
（逆に平行投影は奥行きを一切考慮しないカメラです）

```js
// new THREE.PerspectiveCamera(画角, アスペクト比)
const camera = new THREE.PerspectiveCamera(45, 960 / 540);
```

## 表示するオブジェクトを作る

今回は、立方体を表示するのですが、メッシュという表示オブジェクトを使用することで作成します。メッシュを作るには、**ジオメトリ**（形状）と**マテリアル**（素材）の二種類を用意することで作ることができます。

ジオメトリは図形の頂点情報や面情報を持っています。
Three.jsには様々なジオメトリが用意されていますが、今回は立方体や直方体のような箱型の形状を生成するための`BoxGeometry`を使用します。

```js
// new THREE.BoxGeometry(幅, 高さ, 奥行き)
const geometry = new THREE.BoxGeometry(500, 500, 500);
```

マテリアルは色や質感の情報を持っています。
今回は適当なカラーを割り振る`THREE.MeshNormalMaterial`というマテリアルを生成するクラスのコンストラクターを使います。

```js
const material = new THREE.MeshNormalMaterial();
```

作成したジオメトリとマテリアルを使って、メッシュを作ります。
作成したメッシュをシーンに追加してみます。

```js
// new THREE.Mesh(ジオメトリ,マテリアル)
const box = new THREE.Mesh(geometry, material);
// シーンに追加
scene.add(box);
```

## 最後にアニメーション

`Three.js`では、`renderer.setAnimationLoop()`に更新関数を登録することで、毎フレーム描画ループを構築することができます。

```js
renderer.setAnimationLoop(tick);

function tick() {
  // アニメーション処理をここに書く
}
```

続いて、`Three.js`の表示結果を更新する命令を書きます。
`Three.js`では自動的に画面が切り替わることはないので、明示的に画面が更新されるように命令を書く必要があります。
`renderer.render()`という命令で更新を指示できます。

```js
renderer.setAnimationLoop(tick);

function tick() {
  // アニメーション処理をここに書く

  renderer.render(scene, camera); // レンダリング
}
```

今回のアニメーション処理は回転する立方体ということでしたので、立方体が時間経過で回転するように`rotation.y`プロパティの数値を加算します。

```js
renderer.setAnimationLoop(tick);

function tick() {
  // アニメーション処理をここに書く
  box.rotation.y += 0.01;
  renderer.render(scene, camera); // レンダリング
}
```

こうすることで、y軸を中心に少しずつ回転していくのですが、x軸を中心に回転させたくなったらプロパティを`rotation.x`に変えるだけで変更可能です。

# まとめ

簡単では、ありますが`Three.js`の基本的な解説を行ってみました。
私自身が理解するためにも、これから続けていきたいと思います！

# 参考

今回記事を書くにあたって、以下の記事を参考にさせていただきました。
ありがとうございました🙇

@[card](https://ics.media/tutorial-three/quickstart/)