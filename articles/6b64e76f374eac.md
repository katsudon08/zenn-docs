---
title: "【React基礎】UIの構造を視覚化しよう！2つのツリーが支えるReactの仕組み"
emoji: "🌳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React", "初心者", "フロントエンド"]
published: true
---
# 1.はじめに
Reactで開発を行うとき、私たちはたくさんのコンポーネントを組み合わせて、画面を作ります。
しかし、それらはバラバラに存在しているわけではありません。

Reactはコンポーネント同士のつながりを「**根（ルート）**」から枝分かれして「**葉（リーフ）**」へとつながる「**ツリー（木構造）**」として捉えています。

ただコードが動けばいいじゃないかと思うかもしれませんが、UIをツリーとして理解することには大きなメリットがあります。

- **データの流れが分かる**：Propsはツリーの上から下へと流れていきます。
- **パフォーマンスの仕組みが分かる**：「親の枝」が揺れる（再レンダリング）されると、「子の葉」にどう影響するかを予測しやすくなります。

実は、Web開発において、ツリー構造は目新しいものではありません。
ブラウザがHTMLを読み込んで作る**DOMツリー**もその1つです。

Reactは、このDOMツリーを効率よく操作するために、自分たちの管理しやすい「コンポーネントのツリー」を構築しています。
この記事では、React特有の2つのツリーについて解説していきたいと思います！

# 2.レンダーツリー
Reactコンポーネントの最大の特徴は、コンポーネントの中に別のコンポーネントを配置できる（ネストできる）ことです。
この入れ子構造によって作られるのが、「**レンダーツリー**」です。

例えば、以下のような簡単なアプリの構造を考えてみましょう。

```ts
function MainContent() {
    return (
        <article>
            <Post title="Reactの基本" />
            <Post title="ツリー構造とは" />
        </article>
    );
}

export default function App() {
    return (
        <Layout>
            <Header />
            <MainContent />
            <Footer />
        </Layout>
    );
}
```

このコードから、Reactは以下のような親子関係を構築します。

```
App（ルート）
└─ Layout
   ├─ Header
   ├─ MainContent
   │  ├─ Post（1つ目）
   │  └─ Post（2つ目）
   └─ Footer
```

これがレンダーツリーです。ツリーの頂点にあるコンポーネントを「**ルートコンポーネント**」、末端にあるものを「**リーフコンポーネント**」と呼びます。

レンダーツリーを意識すると、Reactの2つの大きな特徴が理解しやすくなります。

- **データの流れ**：Propsはツリーの上から下へと流れていきます。
親から子へ、子から孫へ...というデータの流れを追いかける際、このツリー図が頭にあれば流れを追いやすくなります。
- **再レンダリングの影響範囲**：Reactでは一般的に、あるコンポーネントが再レンダリングされると、その「枝」の先にある子コンポーネントたちも一緒に再レンダリングされます。
パフォーマンスを考えるうえで、この構造を把握することは不可欠となります。

:::details React DevToolsを使おう
ブラウザの拡張機能である「React DevTools」を使うと、今見ているアプリのレンダーツリーをそのまま確認できます。

HTMLのDOMツリーとは違い、自分で定義してコンポーネント名で表示されるので、デバッグが非常になります。
:::

# 3.モジュール依存関係ツリー
前章のレンダーツリーがコンポーネントの親子関係だったのに対して、こちらはファイル同士が`import`と`export`でどうつながっているかというプログラムの構成の話になります。

ビルドツールやパフォーマンスにおいて非常に重要な概念となります。

例えば、以下のようなファイルの繋がりを考えてみましょう。

- `App.tsx`が`Header.tsx`と`Footer.tsx`をインポートしている。
- `Header.tsx`は`Button.tsx`をインポートしている。

この時、モジュール依存関係ツリーは`App.tsx`を頂点（**エントリポイント**と呼びます）として、ファイル同士のインポート関係を結んでいきます。

このツリーが必要になってくるのは、本番環境に近づいてきてからだと思います。

ユーザーにアプリを届ける際、ブラウザは大量のファイルを1つずつ読み込むのが苦手です。
ですので、`Vite`や`Webpack`といった「**ビルドツール（バンドラー）**」がこのツリーをスキャンしてまとめます。

1. **バンドル（束ねる）**：ツリーをたどって、必要なファイルをすべて1つの塊にまとめます。
2. **ツリーシェイキング（Tree Shaking）**：「インポートはされているけれど、実際には使われていないコード」をツリーから振り落とし、ファイルサイズを小さくします。

レンダーツリーとの違いは、コンポーネントとしての描画で考えるか否かです。

例として、画像ファイルはレンダーツリーには登場しません（コンポーネントではないため）。しかし、コンポーネントがその画像を`import`していれば、モジュール依存関係ツリーには組み込まれています。

# 4.ツリーで考えることのメリット
Reactはツリー構造であるという視点を持つと、コードを書く際のアプローチが点（ファイル）から線（繋がり）へと変わります。

具体的なメリットは以下の3つです。

### 1.stateのリフトアップ
まだ、Reactで頻出の`state`について解説していないのですが、状態（変数など）を表すものだと思っていただいて問題ありません。

どのコンポーネントに`state（状態）`を持たせるのかという迷いが、ツリー構造を意識することで、そのデータが必要なコンポーネントの共通の親に持たせて`Props`で渡すという設計を視覚的に行えるようになります。

これにより、無駄なデータのバケツリレーを防ぐことができます。

### 2.パフォーマンスの境目が分かる
Reactの基本的なルールに「親が再レンダリングされると、子も再レンダリングされる」というものがあります。

ツリーのどの枝が頻繁に更新されるかを把握することで、重い処理をツリーの末端に追いやったり、必要に応じてキャッシュをするなどして、パフォーマンスの最適化を図ることができます。

### 3.アプリのダイエットができる
モジュール依存関係ツリーを意識することで、ユーザーがダウンロードするファイルのサイズ（**バンドルサイズ**）の削減に直結します。

これにより、巨大な枝だけ**遅延読み込み（Lazy Loading）** させるといった戦略が立てやすくなります。

# 5.まとめ
Reactでアプリをツリーとして捉える視点は、効率的な開発とメンテナンスの一歩です！

ツリーがもたらすメリットを最大限生かして、設計や開発を行っていきましょう！

# 6.参考
- [UIをツリーとして理解する](https://ja.react.dev/learn/understanding-your-ui-as-a-tree)