---
title: "TypeScriptã®Promiseã‚’ç†è§£ã™ã‚‹"
emoji: "â³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["TypeScript", "JavaScript", "Promise", "éåŒæœŸå‡¦ç†", "asyncawait"]
published: true
---

::: message
æœ¬è¨˜äº‹ã¯AIã¨å…±åŒã§åŸ·ç­†ã—ã¦ã„ã¾ã™ã€‚
é–“é•ã£ã¦ã„ã‚‹ã¨ã“ã‚ãªã©ãŒã‚ã‚Œã°ã€æŒ‡æ‘˜ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ğŸ˜¿
:::

# ã¯ã˜ã‚ã«

TypeScriptï¼ˆJavaScriptï¼‰ã‚’æ›¸ã„ã¦ã„ã‚‹ã¨ã€å¿…ãšå‡ºä¼šã†ã®ãŒ **Promise** ã§ã™ã€‚

- `Promiseã£ã¦ä½•ï¼Ÿ`
- `then ã¨ await ã®é•ã„ãŒåˆ†ã‹ã‚‰ãªã„`
- éåŒæœŸå‡¦ç†ãŒæ€–ã„

ã“ã®è¨˜äº‹ã§ã¯ã€**Promiseã‚’ã€Œæ¦‚å¿µ â†’ å®Ÿä¾‹ â†’ TypeScriptçš„ãªå‹ã€** ã®é †ã§ã€ã§ãã‚‹ã ã‘å™›ã¿ç •ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. Promiseã¨ã¯ä½•ã‹ï¼Ÿ

**Promise =ã€Œå°†æ¥ã„ã¤ã‹å®Œäº†ã™ã‚‹å‡¦ç†ã®çµæœã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€** ã§ã™ã€‚

JavaScriptã«ã¯ã€ã™ãã«çµæœãŒè¿”ã‚‰ãªã„å‡¦ç†ãŒãŸãã•ã‚“ã‚ã‚Šã¾ã™ã€‚

- APIé€šä¿¡
- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
- ã‚¿ã‚¤ãƒãƒ¼
- DBã‚¢ã‚¯ã‚»ã‚¹

```ts
const result = fetchData(); // â† ä»Šã™ãå€¤ã¯è¿”ã‚‰ãªã„
````

ã“ã®ã‚ˆã†ãªã€Œ**ã¾ã çµæœãŒåˆ†ã‹ã‚‰ãªã„å‡¦ç†**ã€ã‚’å®‰å…¨ã«æ‰±ã†ãŸã‚ã®ä»•çµ„ã¿ãŒ Promise ã§ã™ã€‚

---

## 2. Promiseã®3ã¤ã®çŠ¶æ…‹

Promiseã¯å¿…ãšæ¬¡ã®3ã¤ã®ã©ã‚Œã‹ã®çŠ¶æ…‹ã‚’æŒã¡ã¾ã™ã€‚

| çŠ¶æ…‹        | æ„å‘³  |
| --------- | --- |
| pending   | å®Ÿè¡Œä¸­ |
| fulfilled | æˆåŠŸ  |
| rejected  | å¤±æ•—  |

ãƒã‚¤ãƒ³ãƒˆã¯ã€

> **ä¸€åº¦ fulfilled / rejected ã«ãªã‚‹ã¨ã€äºŒåº¦ã¨å¤‰ã‚ã‚‰ãªã„**

ã¨ã„ã†ç‚¹ã§ã™ã€‚

---

## 3. Promiseã‚’ä½œã£ã¦ã¿ã‚‹

```ts
const promise = new Promise<number>((resolve, reject) => {
  setTimeout(() => {
    resolve(42); // æˆåŠŸ
    // reject(new Error("å¤±æ•—"));
  }, 1000);
});
```

### ã“ã“ã§ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

* `resolve(value)` â†’ æˆåŠŸ
* `reject(error)` â†’ å¤±æ•—
* `<number>` ã¯ã€ŒæˆåŠŸæ™‚ã«è¿”ã‚‹å€¤ã®å‹ã€

---

## 4. Promiseã‚’ä½¿ã†ï¼ˆthen / catchï¼‰

```ts
promise
  .then((value) => {
    console.log(value); // 42
  })
  .catch((error) => {
    console.error(error);
  });
```

* `then`ï¼šæˆåŠŸæ™‚ã«å‘¼ã°ã‚Œã‚‹
* `catch`ï¼šå¤±æ•—æ™‚ã«å‘¼ã°ã‚Œã‚‹

ãŸã ã—ã€**ã“ã®æ›¸ãæ–¹ã¯å°‘ã—èª­ã¿ã«ãã„** ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

---

## 5. async / awaitï¼ˆæœ€é‡è¦ï¼‰

Promiseã‚’æ‰±ã†ã¨ãã®æœ¬å‘½ãŒ **async / await** ã§ã™ã€‚

```ts
async function sample() {
  const value = await promise;
  console.log(value); // 42
}
```

### ä½•ãŒèµ·ãã¦ã„ã‚‹ï¼Ÿ

* `await` ã¯ **PromiseãŒçµ‚ã‚ã‚‹ã¾ã§å¾…ã¤**
* è¦‹ãŸç›®ã¯åŒæœŸå‡¦ç†
* å®Ÿéš›ã¯éåŒæœŸã§å‹•ã„ã¦ã„ã‚‹

ğŸ‘‰ **ã€ŒPromiseã‚’awaitã™ã‚‹ã¨ä¸­èº«ã®å‹ã«ãªã‚‹ã€**
ã“ã‚ŒãŒTypeScriptã§éå¸¸ã«é‡è¦ã§ã™ã€‚

---

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆtry / catchï¼‰

```ts
async function sample() {
  try {
    const value = await promise;
    console.log(value);
  } catch (error) {
    console.error(error);
  }
}
```

Promiseã® `reject` ã¯ã€`throw` ã¨åŒã˜æ‰±ã„ã«ãªã‚Šã¾ã™ã€‚

---

## 7. TypeScriptçš„ã«è¦‹ã‚‹Promiseã®å‹

```ts
function fetchNumber(): Promise<number> {
  return Promise.resolve(10);
}
```

ã“ã‚Œã¯

> **ã€Œå°†æ¥ number ã‚’è¿”ã™ã€**

ã¨ã„ã†æ„å‘³ã§ã™ã€‚

```ts
const n = await fetchNumber();
// n ã¯ number å‹
```

* `Promise<T>` â†’ æœªæ¥ã® T
* `await Promise<T>` â†’ T

---

## 8. ã‚ˆãä½¿ã†Promiseã®ä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰

### Promise.resolve / Promise.reject

```ts
Promise.resolve(1);
Promise.reject("error");
```

ãƒ†ã‚¹ãƒˆã‚„ãƒ€ãƒŸãƒ¼å®Ÿè£…ã§ã‚ˆãä½¿ã„ã¾ã™ã€‚

---

### Promise.allï¼ˆå…¨ã¦å®Œäº†ã™ã‚‹ã¾ã§å¾…ã¤ï¼‰

```ts
const results = await Promise.all([
  Promise.resolve(1),
  Promise.resolve(2),
  Promise.resolve(3),
]);
// results: number[]
```

* å…¨éƒ¨æˆåŠŸ â†’ æˆåŠŸ
* 1ã¤ã§ã‚‚å¤±æ•— â†’ å…¨ä½“ãŒå¤±æ•—

---

### Promise.raceï¼ˆæœ€åˆã«çµ‚ã‚ã£ãŸã‚‚ã®ï¼‰

```ts
await Promise.race([
  fetchA(),
  fetchB(),
]);
```

---

## 9. ã‚ˆãã‚ã‚‹ãƒŸã‚¹

### await ã‚’ä»˜ã‘å¿˜ã‚Œã‚‹

```ts
const value = fetchNumber();
console.log(value); // Promise<number>
```

âœ… æ­£ã—ãã¯

```ts
const value = await fetchNumber();
```

---

### async ã‚’ä»˜ã‘å¿˜ã‚Œã‚‹

```ts
function foo() {
  await fetchNumber(); // ã‚¨ãƒ©ãƒ¼
}
```

âœ…

```ts
async function foo() {
  await fetchNumber();
}
```

---

## 10. å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆãŠã™ã™ã‚ï¼‰

* MDN
  [https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise)

---

## ã¾ã¨ã‚

* Promiseã¯ã€Œæœªæ¥ã®å€¤ã€
* TypeScriptã§ã¯ `Promise<T>` ã® `T` ãŒè¶…é‡è¦
* å®Ÿå‹™ã§ã¯ **async / await ãŒåŸºæœ¬**

Promiseã‚’ç†è§£ã™ã‚‹ã¨ã€
**APIé€šä¿¡ãƒ»Reactãƒ»Node.js ã®ç†è§£ãŒä¸€æ°—ã«æ¥½ã«ãªã‚Šã¾ã™ã€‚**